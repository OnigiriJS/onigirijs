<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçô i18n Debug Test</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçô</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçô</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="stylesheet" href="static/css/style.css">
<!-- ===============================================================
      ____        _       _      _      _  _____ 
     / __ \      (_)     (_)    (_)    | |/ ____|
    | |  | |_ __  _  __ _ _ _ __ _     | | (___  
    | |  | | '_ \| |/ _` | | '__| |_   | |\___ \ 
    | |__| | | | | | (_| | | |  | | |__| |____) |
     \____/|_| |_|_|\__, |_|_|  |_|\____/|_____/ 
                     __/ |                       
                    |___/                        
 ===============================================================

   Lightweight, deliciously simple, modular JavaScript framework for building reactive HumHub modules with enterprise-grade security

   Website:   https://onigirijs.greenmeteor.net/
   License:   BSD-3-Clause

   Copyright (c) 2025 Green Meteor

   Redistribution and use in source and binary forms, with or
   without modification, are permitted provided that the
   conditions of the BSD 3-Clause License are met.

   SPDX-License-Identifier: BSD-3-Clause
 =============================================================== -->
</head>
<body>
    <h1>üçô OnigiriJS i18n Debug Test</h1>

    <div>
        <label>Language: </label>
        <select id="lang-select">
            <option value="en">English</option>
            <option value="es">Espa√±ol</option>
            <option value="fr">Fran√ßais</option>
            <option value="ja">Êó•Êú¨Ë™û</option>
        </select>
    </div>

    <div class="debug" id="debug-info">Loading...</div>

    <h2 data-i18n="shop.title">Shop Title</h2>

    <div id="menu-container"></div>

    <script>
    (function(global) {
        function Onigiri(selector) {
            if (!(this instanceof Onigiri)) return new Onigiri(selector);
            this.elements = typeof selector === 'string' 
                ? Array.from(document.querySelectorAll(selector))
                : [selector];
            this.length = this.elements.length;
            return this;
        }

        Onigiri.prototype.each = function(cb) {
            this.elements.forEach((el, i) => cb.call(el, el, i));
            return this;
        };

        Onigiri.prototype.html = function(content) {
            if (content === undefined) return this.elements[0]?.innerHTML;
            this.each(el => el.innerHTML = content);
            return this;
        };

        Onigiri.prototype.text = function(content) {
            if (content === undefined) return this.elements[0]?.textContent;
            this.each(el => el.textContent = content);
            return this;
        };

        Onigiri.prototype.on = function(event, handler) {
            this.each(el => el.addEventListener(event, handler));
            return this;
        };

        Onigiri.extend = function(target, ...sources) {
            sources.forEach(source => Object.assign(target, source));
            return target;
        };

        Onigiri.modules = {};
        global.Onigiri = global.O = Onigiri;
    })(window);
    </script>

    <script>
    Onigiri.i18n = {
        _config: { locale: 'en', fallbackLocale: 'en' },
        _translations: {},

        init: function(options) {
            Onigiri.extend(this._config, options || {});
            return this;
        },

        setLocale: function(locale) {
            this._config.locale = locale;
            document.dispatchEvent(new CustomEvent('onigiri:locale:changed', { detail: { locale } }));
            return this;
        },

        getLocale: function() {
            return this._config.locale;
        },

        addTranslations: function(locale, translations) {
            if (!this._translations[locale]) this._translations[locale] = {};
            Onigiri.extend(this._translations[locale], translations);
            return this;
        },

        t: function(key, params, locale) {
            locale = locale || this._config.locale;
            let value = this._translations[locale];

            const parts = key.split('.');
            for (let i = 0; i < parts.length; i++) {
                if (value && typeof value === 'object' && parts[i] in value) {
                    value = value[parts[i]];
                } else {
                    return null;
                }
            }

            if (typeof value === 'string' && params) {
                return value.replace(/\{([^}]+)\}/g, (m, k) => params[k] !== undefined ? params[k] : m);
            }

            return typeof value === 'string' ? value : null;
        },

        translatePage: function() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                const translation = this.t(key);
                if (translation !== null) {
                    el.textContent = translation;
                }
            });
            return this;
        }
    };

    Onigiri.t = (...args) => Onigiri.i18n.t(...args);
    Onigiri.modules.translation = true;

    document.addEventListener('onigiri:locale:changed', () => {
        Onigiri.i18n.translatePage();
    });
    </script>

    <script>
    Onigiri.i18n.init({ locale: 'en' });

    Onigiri.i18n.addTranslations('en', {
        shop: { title: 'üçô Onigiri Shop' },
        menu: {
            salmon: { name: 'Salmon Onigiri', desc: 'Fresh salmon with seasoned rice' },
            tuna: { name: 'Tuna Onigiri', desc: 'Spicy tuna with mayo' }
        }
    });

    Onigiri.i18n.addTranslations('es', {
        shop: { title: 'üçô Tienda Onigiri' },
        menu: {
            salmon: { name: 'Onigiri de Salm√≥n', desc: 'Salm√≥n fresco con arroz sazonado' },
            tuna: { name: 'Onigiri de At√∫n', desc: 'At√∫n picante con mayonesa' }
        }
    });

    Onigiri.i18n.addTranslations('fr', {
        shop: { title: 'üçô Boutique Onigiri' },
        menu: {
            salmon: { name: 'Onigiri au Saumon', desc: 'Saumon frais avec riz assaisonn√©' },
            tuna: { name: 'Onigiri au Thon', desc: 'Thon √©pic√© avec mayonnaise' }
        }
    });

    Onigiri.i18n.addTranslations('ja', {
        shop: { title: 'üçô „Åä„Å´„Åé„Çä„Ç∑„Éß„ÉÉ„Éó' },
        menu: {
            salmon: { name: 'ÈÆ≠„Åä„Å´„Åé„Çä', desc: 'Êñ∞ÈÆÆ„Å™ÈÆ≠„Å®Âë≥‰ªò„Åë„ÅîÈ£Ø' },
            tuna: { name: '„ÉÑ„Éä„Åä„Å´„Åé„Çä', desc: '„Çπ„Éë„Ç§„Ç∑„Éº„ÉÑ„Éä„Å®„Éû„É®„Éç„Éº„Ç∫' }
        }
    });
    </script>

    <script>
    function updateDebug() {
        const info = {
            currentLocale: Onigiri.i18n.getLocale(),
            translationsLoaded: Object.keys(Onigiri.i18n._translations),
            testTranslation: Onigiri.t('menu.salmon.name')
        };
        O('#debug-info').text(JSON.stringify(info, null, 2));
    }

    function renderMenu() {
        const menu = [
            { id: 1, nameKey: 'menu.salmon.name', descKey: 'menu.salmon.desc', price: 3.50, emoji: 'üêü' },
            { id: 2, nameKey: 'menu.tuna.name', descKey: 'menu.tuna.desc', price: 3.50, emoji: 'üê†' }
        ];

        const container = O('#menu-container');
        let html = '';

        menu.forEach(item => {
            const name = Onigiri.t(item.nameKey) || item.nameKey;
            const desc = Onigiri.t(item.descKey) || item.descKey;

            html += `
                <div class="menu-item">
                    <h3>${item.emoji} ${name}</h3>
                    <p>${desc}</p>
                    <div>$${item.price.toFixed(2)}</div>
                </div>
            `;
        });

        container.html(html);
    }

    O('#lang-select').on('change', function() {
        Onigiri.i18n.setLocale(this.value);
        updateDebug();
        renderMenu();
    });

    Onigiri.i18n.translatePage();
    updateDebug();
    renderMenu();

    </script>
</body>
</html>
